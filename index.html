
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Magazzino Casalinghi</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // Icone Lucide React (versione semplificata inline)
        const Package = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
            </svg>
        );

        const Search = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const Plus = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const Edit2 = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        );

        const Trash2 = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const Camera = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const X = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const Save = ({className, ...props}) => (
            <svg className={className} {...props} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
            </svg>
        );

        function InventoryApp() {
            const [products, setProducts] = useState([]);
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [scanning, setScanning] = useState(false);
            const [formData, setFormData] = useState({
                barcode: '',
                nome: '',
                categoria: '',
                fornitore: '',
                prezzoFornitore: '',
                prezzoVendita: '',
                quantita: '',
                note: ''
            });

            const videoRef = useRef(null);
            const streamRef = useRef(null);

            const categorie = ['Cucina', 'Bagno', 'Pulizia', 'Tavola', 'Arredo', 'Elettrodomestici', 'Altro'];

            const resetForm = () => {
                setFormData({
                    barcode: '',
                    nome: '',
                    categoria: '',
                    fornitore: '',
                    prezzoFornitore: '',
                    prezzoVendita: '',
                    quantita: '',
                    note: ''
                });
                setEditingId(null);
            };

            const handleSubmit = () => {
                if (!formData.barcode || !formData.nome || !formData.categoria || !formData.fornitore || 
                    !formData.prezzoFornitore || !formData.prezzoVendita || !formData.quantita) {
                    alert('Compila tutti i campi obbligatori');
                    return;
                }
                
                const newProduct = {
                    ...formData,
                    id: editingId || Date.now(),
                    prezzoFornitore: parseFloat(formData.prezzoFornitore) || 0,
                    prezzoVendita: parseFloat(formData.prezzoVendita) || 0,
                    quantita: parseInt(formData.quantita) || 0,
                    dataAggiunta: editingId ? products.find(p => p.id === editingId)?.dataAggiunta : new Date().toISOString()
                };

                if (editingId) {
                    setProducts(products.map(p => p.id === editingId ? newProduct : p));
                } else {
                    setProducts([...products, newProduct]);
                }

                resetForm();
                setShowForm(false);
            };

            const handleEdit = (product) => {
                setFormData({
                    barcode: product.barcode,
                    nome: product.nome,
                    categoria: product.categoria,
                    fornitore: product.fornitore,
                    prezzoFornitore: product.prezzoFornitore.toString(),
                    prezzoVendita: product.prezzoVendita.toString(),
                    quantita: product.quantita.toString(),
                    note: product.note || ''
                });
                setEditingId(product.id);
                setShowForm(true);
            };

            const handleDelete = (id) => {
                if (window.confirm('Sei sicuro di voler eliminare questo prodotto?')) {
                    setProducts(products.filter(p => p.id !== id));
                }
            };

            const startScanning = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'environment' } 
                    });
                    streamRef.current = stream;
                    if (videoRef.current) {
                        videoRef.current.srcObject = stream;
                    }
                    setScanning(true);
                } catch (err) {
                    alert('Impossibile accedere alla fotocamera. Inserisci il barcode manualmente.');
                }
            };

            const stopScanning = () => {
                if (streamRef.current) {
                    streamRef.current.getTracks().forEach(track => track.stop());
                    streamRef.current = null;
                }
                setScanning(false);
            };

            const filteredProducts = products.filter(p => 
                p.nome.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.barcode.includes(searchTerm) ||
                p.fornitore.toLowerCase().includes(searchTerm.toLowerCase()) ||
                p.categoria.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const totaleInventario = products.reduce((sum, p) => sum + (p.prezzoFornitore * p.quantita), 0);
            const margineAtteso = products.reduce((sum, p) => sum + ((p.prezzoVendita - p.prezzoFornitore) * p.quantita), 0);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
                    <div className="max-w-7xl mx-auto p-4 sm:p-6">
                        <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                            <div className="flex items-center justify-between mb-4">
                                <div className="flex items-center gap-3">
                                    <Package className="w-8 h-8 text-indigo-600" />
                                    <h1 className="text-3xl font-bold text-gray-800">Magazzino Casalinghi</h1>
                                </div>
                                <button
                                    onClick={() => setShowForm(true)}
                                    className="flex items-center gap-2 bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition"
                                >
                                    <Plus className="w-5 h-5" />
                                    Nuovo Prodotto
                                </button>
                            </div>

                            <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4">
                                <div className="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-4 rounded-lg">
                                    <div className="text-sm opacity-90">Prodotti Totali</div>
                                    <div className="text-2xl font-bold">{products.length}</div>
                                </div>
                                <div className="bg-gradient-to-br from-green-500 to-green-600 text-white p-4 rounded-lg">
                                    <div className="text-sm opacity-90">Valore Inventario</div>
                                    <div className="text-2xl font-bold">€{totaleInventario.toFixed(2)}</div>
                                </div>
                                <div className="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-4 rounded-lg">
                                    <div className="text-sm opacity-90">Margine Atteso</div>
                                    <div className="text-2xl font-bold">€{margineAtteso.toFixed(2)}</div>
                                </div>
                            </div>

                            <div className="mt-4 relative">
                                <Search className="absolute left-3 top-3 w-5 h-5 text-gray-400" />
                                <input
                                    type="text"
                                    placeholder="Cerca per nome, barcode, fornitore o categoria..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                />
                            </div>
                        </div>

                        {showForm && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                                <div className="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                                    <div className="sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between">
                                        <h2 className="text-2xl font-bold text-gray-800">
                                            {editingId ? 'Modifica Prodotto' : 'Nuovo Prodotto'}
                                        </h2>
                                        <button onClick={() => { setShowForm(false); resetForm(); stopScanning(); }} className="text-gray-500 hover:text-gray-700">
                                            <X className="w-6 h-6" />
                                        </button>
                                    </div>

                                    <div className="p-6 space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Barcode *</label>
                                            <div className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={formData.barcode}
                                                    onChange={(e) => setFormData({...formData, barcode: e.target.value})}
                                                    className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="Es: 8001234567890"
                                                />
                                                <button
                                                    type="button"
                                                    onClick={scanning ? stopScanning : startScanning}
                                                    className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
                                                >
                                                    <Camera className="w-5 h-5" />
                                                </button>
                                            </div>
                                            {scanning && (
                                                <div className="mt-2">
                                                    <video ref={videoRef} autoPlay playsInline className="w-full rounded-lg border-2 border-indigo-500" />
                                                    <p className="text-sm text-gray-600 mt-2">Inquadra il barcode</p>
                                                </div>
                                            )}
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Nome Prodotto *</label>
                                            <input
                                                type="text"
                                                value={formData.nome}
                                                onChange={(e) => setFormData({...formData, nome: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="Es: Set Pentole"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Categoria *</label>
                                            <select
                                                value={formData.categoria}
                                                onChange={(e) => setFormData({...formData, categoria: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                            >
                                                <option value="">Seleziona categoria</option>
                                                {categorie.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Fornitore *</label>
                                            <input
                                                type="text"
                                                value={formData.fornitore}
                                                onChange={(e) => setFormData({...formData, fornitore: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="Es: Casa & Co."
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Prezzo Fornitore (€) *</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={formData.prezzoFornitore}
                                                    onChange={(e) => setFormData({...formData, prezzoFornitore: e.target.value})}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="12.50"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Prezzo Vendita (€) *</label>
                                                <input
                                                    type="number"
                                                    step="0.01"
                                                    value={formData.prezzoVendita}
                                                    onChange={(e) => setFormData({...formData, prezzoVendita: e.target.value})}
                                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                    placeholder="19.90"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Quantità *</label>
                                            <input
                                                type="number"
                                                value={formData.quantita}
                                                onChange={(e) => setFormData({...formData, quantita: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                placeholder="10"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Note</label>
                                            <textarea
                                                value={formData.note}
                                                onChange={(e) => setFormData({...formData, note: e.target.value})}
                                                className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                                rows="3"
                                                placeholder="Note aggiuntive..."
                                            />
                                        </div>

                                        {formData.prezzoFornitore && formData.prezzoVendita && (
                                            <div className="bg-indigo-50 p-4 rounded-lg">
                                                <div className="text-sm text-gray-700">
                                                    Margine unitario: <span className="font-bold text-indigo-600">
                                                        €{(parseFloat(formData.prezzoVendita) - parseFloat(formData.prezzoFornitore)).toFixed(2)}
                                                    </span> ({((parseFloat(formData.prezzoVendita) - parseFloat(formData.prezzoFornitore)) / parseFloat(formData.prezzoVendita) * 100).toFixed(1)}%)
                                                </div>
                                            </div>
                                        )}

                                        <div className="flex gap-3 pt-4">
                                            <button
                                                onClick={handleSubmit}
                                                className="flex-1 flex items-center justify-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-medium"
                                            >
                                                <Save className="w-5 h-5" />
                                                {editingId ? 'Aggiorna' : 'Salva'}
                                            </button>
                                            <button
                                                onClick={() => { setShowForm(false); resetForm(); stopScanning(); }}
                                                className="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-medium"
                                            >
                                                Annulla
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div className="grid gap-4">
                            {filteredProducts.length === 0 ? (
                                <div className="bg-white rounded-xl shadow p-12 text-center">
                                    <Package className="w-16 h-16 text-gray-300 mx-auto mb-4" />
                                    <p className="text-gray-500 text-lg">
                                        {products.length === 0 ? 'Nessun prodotto in magazzino. Aggiungi il primo!' : 'Nessun prodotto trovato.'}
                                    </p>
                                </div>
                            ) : (
                                filteredProducts.map(product => (
                                    <div key={product.id} className="bg-white rounded-xl shadow hover:shadow-lg transition p-6">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className="flex-1">
                                                <h3 className="text-xl font-bold text-gray-800 mb-1">{product.nome}</h3>
                                                <div className="flex flex-wrap gap-2 text-sm text-gray-600">
                                                    <span className="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full">{product.categoria}</span>
                                                    <span className="bg-gray-100 px-3 py-1 rounded-full">📦 {product.barcode}</span>
                                                    <span className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full">🏢 {product.fornitore}</span>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => handleEdit(product)} className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition">
                                                    <Edit2 className="w-5 h-5" />
                                                </button>
                                                <button onClick={() => handleDelete(product.id)} className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition">
                                                    <Trash2 className="w-5 h-5" />
                                                </button>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-4 bg-gray-50 p-4 rounded-lg">
                                            <div>
                                                <div className="text-xs text-gray-500 mb-1">Prezzo Fornitore</div>
                                                <div className="text-lg font-bold text-gray-800">€{product.prezzoFornitore.toFixed(2)}</div>
                                            </div>
                                            <div>
                                                <div className="text-xs text-gray-500 mb-1">Prezzo Vendita</div>
                                                <div className="text-lg font-bold text-green-600">€{product.prezzoVendita.toFixed(2)}</div>
                                            </div>
                                            <div>
                                                <div className="text-xs text-gray-500 mb-1">Quantità</div>
                                                <div className="text-lg font-bold text-gray-800">{product.quantita} pz</div>
                                            </div>
                                            <div>
                                                <div className="text-xs text-gray-500 mb-1">Margine</div>
                                                <div className="text-lg font-bold text-purple-600">€{(product.prezzoVendita - product.prezzoFornitore).toFixed(2)}</div>
                                            </div>
                                        </div>

                                        {product.note && (
                                            <div className="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                                                <p className="text-sm text-gray-700"><strong>Note:</strong> {product.note}</p>
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<InventoryApp />, document.getElementById('root'));
    </script>
</body>
</html>
